---
layout:     post
title:      "如何在阿里云搭建业务生产ECS服务器？"
subtitle:   "《推蜜》官方互动养成APP，借力《阿里云》从零到壹的演变"
date:       2017-01-01 10:00:00
author:     "李牧牧"
header-img: "http://onb688cva.bkt.clouddn.com/assets:img:home-bg.jpg"
header-mask: 0.1
catalog:    true
tags:
    - 阿里云
    - 混合云
---

> 本文发布于 [李牧牧的博客](http://limumu.me) 转载请保留链接 ;)

  

提示：

> 阿里云管理操作界面样式总会变化，但思路不会变，如果您登录的操作界面与文章示例图片不太一致，请谅解。



### 如何根据业务选择服务器配置？

只要不是运行在服务器的程序或者网络带宽出现问题，通常如果CPU使用率达到90%以上，内存使用率达到95%左右，任何对服务器发出的请求与指令都得不到回应或者非常缓慢，基本可以确定服务器是因为用户访问量太大而顶不住了。依据这种情况我们知道，能不能支撑起用户的访问量，服务器的CPU、内存、带宽起关键作用。



> 物尽其用，合理分配，越了解需求，成本越低

其实降低成本的方法就是对用户量与业务本身需求的了解情况而定。

业务服务器只是用来做逻辑运算与核心数据返回，不同业务场景的项目要拆分出来（用户资产项目、支付项目、网页项目、商城项目、运营平台项目），每个项目构建不同的业务ECS服务器集群，每个集群对应着单独的SLB负载均衡并配置独立二级域名（app.domain.com、pay.domain.com、h5.domain.com、op.domain.com）， 这样做就会从业务上把流量的压力拆分出来。

静态文件（视频、音频、图片、资源文件）依据文件类型分类单独放到OSS分片云储存中，给OSS配置CDN内容分发网络并配置二级域名（cdn.img.domain.com、cdn.video.domain.com、cdn.static.domain.com），这样做就会把资源请求的压力交给云储存设备与全国各地的CDN设备。

数据库配置RDS主服务器与RDS从服务器，ECS集群写数据找主服务器，ECS集群读数据找从服务器。

尽可能的依赖独立的缓存系统，ECS集群能从缓存系统查询绝不走数据库，缓存系统配置好主从关系，写缓存找主缓存系统，读缓存找从缓存系统。

按照以上方式规划好服务后，根据笔者所在企业数据统计，百万注册用户量，日均PV能达到500万，我们依照计算公式得到服务器的并发量。

```
计算公式: 每台服务器每秒处理请求的数量=((80%*总PV量)/(24小时*60分*60秒*40%)) / 服务器数量
```

```
单台ECS承受并发数：((80%*500*10000)/(24*60*60*40)) / 1 ≈ 138 
```

按照阿里云ECS服务器购买清单对比，购买新1核1G内存服务器比升级配置要划算，假如用户数增多并发增大，我们继续横向增加38.25元每月的 1核1G内存服务器 就可以了。

注意：每个ECS业务集群服务器一定要配置独立的SLB负载均衡器，负载均衡设置好带宽峰值为5-10M。


| 设备名称   | 配置     | 外网带宽/硬盘              | 价格（月/年）       |
| ------ | ------ | -------------------- | ------------- |
| ECS服务器 | 1核1G内存 | 0M外网带宽，默认40G硬盘，非IO优化 | 38.25/459     |
| ECS服务器 | 2核2G内存 | 0M外网带宽，默认40G硬盘，非IO优化 | 125.28/1509.6 |

[阿里云ECS服务器租赁价格计算器](https://www.aliyun.com/price/product#/ecs/calculator "阿里云ECS服务器租赁价格计算器")  - 来源 阿里云

[应用并发的计算方式](http://blog.csdn.net/zhang_xiao8wan8/article/details/45814985 "阿里云ECS服务器租赁价格计算器")  - 来源 CSDN











